# 4_회귀모형진단

[TOC]

## 1. 모형의 선형성

- 진단: 잔차 산점도가 선형인지 확인

- 처방: 비선형회귀모형을 설정하거나 변수변환을 하여 선형이 되도록 하기

<br>

---

<br>

## 2. 잔차 진단

**잔차(residuals)**: 남아있는 오차, 추정 회귀식이 반응변수 관찰치를 설명하지 못하는 부분

- 잔차 산점도 (Residual Plot)를 그렸을 때 평평한 띠 모양

- 오차항에 대한 가정 검토: 독립성, 정규성, 등분산성

<br>

### 2-1. 오차의 등분산성

- 진단: 잔차 산점도에서 띠 모양이 나오는지 확인
- 처방: 등분산이 되도록 모형을 조정하거나 이분산을 고려한 모형으로 바꾸기

<br>

### 2-2. 오차의 정규성

- 진단: 잔차의 히스토그램, 줄기잎그림을 그려 정규 분포 모양인지 확인
  - Shapiro-Wilk W 통계량
  - `Normal Q-Q plot`
- 처방: 변수변환을 하기

<br>

### 2-3. 오차의 독립성

- 진단: Durbin-watson 통계량

<br>

---

<br>

## 3. 이상치

**이상치 (Outlier)**: 주어진 회귀 모델에 의해 잘 설명되지 않는 데이터 점들 

**스튜던트화 잔차 (Studentized Residual)**: 잔차를 잔차의 표준편차로 나눈 값

- 진단: 잔차 (외면 스튜던트화 잔차)
- 처방: 입력 실수인지 확인, 이상치를 그대로 포함할지, 제거한 후 선형 모형을 적용할지 확인

**영향관찰치**: 영향력이 큰 이상치

- 진단: 영향력을 판단하기 위해 제거한 후 모형을 추정하고 추정치 값들과 R2가 얼마나 차이나는지 확인
- 처방: 입력 실수인지 확인

```r
> data(Orange)
> m <- lm(circumference ~ age + I(age^2), data=Orange)
> rstudent(m)
          1           2           3           4 
 0.19985287 -0.53303263 -0.17840851 -0.54325622 
          5           6           7           8 
-1.31082205 -0.92292494 -1.72799370  0.33615199 
          9          10          11          12 
-0.06394288  0.85316955  1.23124345  0.92915017 
         13          14          15          16 
 1.75080916  0.93486279  0.19985287 -0.83687327 
         17          18          19          20 
-0.69447869 -0.84791970 -1.54276649 -1.05591062 
         21          22          23          24 
-1.98782529  0.29066403 -0.36166980  0.89732592 
         25          26          27          28 
 1.75037512  1.24135751  2.05032759  1.45729711 
         29          30          31          32 
 0.19985287 -0.92493008 -0.43504980 -0.11561888 
         33          34          35 
-0.34906199  0.44471090 -0.23134075 
```

<br>

**본페로니 교정 (Bonferroni correction)**: 다중 비교에서 검정하는 가설의 숫자가 늘어나면 귀무가설이 기각될 확률이 낮더라도 기각될 가능성 더욱 늘어나게 된다. 귀무가설이 참임에도 불구하고 기각하는 제1종 오류를 보정하기 위해서 여러 개의 가설들에 대해서 최소한 하나의 제1종오류가 발생할 가능성을 계산해 보정할 수 있다. 

> 스튜던트화 잔차는 t분포를 따르므로 t-test를 사용해 `rstudent()` 값이 너무 크거나 작은 점을 찾기: 36번째 데이터에서 Bonferroni p < 0.05 이므로 이상치 검출

```r
> Orange <- rbind(Orange, data.frame(Tree=as.factor(c(6, 6, 6)), age=c(118, 484, 664), circumference=c(177, 50, 30)))
> tail(Orange)
   Tree  age circumference
33    5 1231           142
34    5 1372           174
35    5 1582           177
36    6  118           177
37    6  484            50
38    6  664            30
```

```r
> m <- lm(circumference ~ age + I(age^2), data=Orange)
> outlierTest(m)
   rstudent unadjusted p-value Bonferroni p
36 5.538438          3.429e-06    0.0001303
```

<br>

---

<br>

## 4. 다중공선성

**다중공선성 (Multicollinearity)**: X변수 중 하나와 다른 X 변수들의 선형결합이 매우 높은 상관관계에 있을 때 / X변수들 사이의 선형 독립성이 성립하지 못한 상태

- 다중공선성이 존재하면 X변수들의 기울기를 정확히 계산하지 못하거나 아예 계산이 되지 않는다

- 진단
  - 산점도 행렬 또는 설명 변수끼리의 산점도에서 거의 직선에 가까운 선형관계를 보이는 경우
  - 설명 변수를 뺄 때와 추가할 때 다른 설명변수들의 기울기 추정값들이 많이 변동하는 경우
  - ANOVA에 의해 유의적으로 기울기들이 모두 0이 아니지만 문제가 되는 X변수의 기울기는 유의적이지 않은 경우
  - 통계적 검정
- 처방: X변수들끼리 선형 독립성을 유지해야하므로 문제가 되는 X변수를 제거한다

<br>

---

<br>

## 5. 그래프

```r
plot(m)
```

`Residuals vs Fitted plot`

- X축 - 선형 회귀로 예측된 Y값, Y축 - 잔차

- 0에서 멀리 떨어진 값: 이상치 가능

![image-20210706175309436](C:/Users/USER/Desktop/chenni0531/Data Analysis/study-TIL/00_통계분석/1_회귀분석/1_선형회귀/1_단순선형회귀.assets/image-20210706175309436.png)

`Normal Q-Q plot`

![image-20210706175328632](C:/Users/USER/Desktop/chenni0531/Data Analysis/study-TIL/00_통계분석/1_회귀분석/1_선형회귀/1_단순선형회귀.assets/image-20210706175328632.png)

`Scale-Location plot`

- X축 - 선형 회귀로 예측된 Y값, Y축 - 표준화 잔차
- 0에서 멀리 떨어진 값: 이상치 가능

![image-20210706175340869](C:/Users/USER/Desktop/chenni0531/Data Analysis/study-TIL/00_통계분석/1_회귀분석/1_선형회귀/1_단순선형회귀.assets/image-20210706175340869.png)

`Residuals vs Leverage plot`

- X축 - 레버리지, Y축 - 표준화 잔차

- 레버리지: 설명변수가 얼마나 극단에 치우쳐 있는지
- 쿡의 거리 (Cook's Distance): 회귀 직선의 모양에 크게 영향을 끼치는 점들을 찾는 방법으로, 레버리지와 잔차에 비례 (우측 상단, 우측 하단)

![image-20210706175223296](C:/Users/USER/Desktop/chenni0531/Data Analysis/study-TIL/00_통계분석/1_회귀분석/1_선형회귀/1_단순선형회귀.assets/image-20210706175223296.png)

<br>

```r
plot(m, which=c(4, 6))
```

`Cook's distance`

![image-20210706235812906](C:/Users/USER/Desktop/chenni0531/Data Analysis/study-TIL/00_통계분석/1_회귀분석/1_선형회귀/1_단순선형회귀.assets/image-20210706235812906.png)

`Cook's dist vs Leverage`

![image-20210706235823326](C:/Users/USER/Desktop/chenni0531/Data Analysis/study-TIL/00_통계분석/1_회귀분석/1_선형회귀/1_단순선형회귀.assets/image-20210706235823326.png)



